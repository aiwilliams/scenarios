<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Scenario</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Scenario</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/scenarios_rb.html">
                lib/scenarios.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h2>Rails <a href="Scenarios.html">Scenarios</a> Plugin</h2>
<p>
Who hasn&#8216;t experienced the pain of dozens of YAML files filled with
hundreds of inter-related data structures? When do you look at People of an
Organization and not have to look at the organization_id, open the
organizations.yml file, and search for &#8216;id: X&#8217;?
</p>
<p>
In a nutshell, scenarios are a drop in replacement for YAML fixtures.
Instead of encouraging you to create a mindless amount of raw data in the
form of YAML, scenarios encourage you to create code that populates your
tables with the appropriate records.
</p>
<h3>Quick Start</h3>
<p>
<a href="Scenarios.html">Scenarios</a> should be placed in the
spec/scenarios directory of your Rails project. <a
href="Scenario.html">Scenario</a> file names always end in
&quot;_scenario.rb&quot; and classes end in &quot;<a
href="Scenario.html">Scenario</a>&quot;.
</p>
<p>
A simple scenario looks like this:
</p>
<pre>
  # in spec/scenarios/users_scenario.rb
  class UsersScenario &lt; Scenario::Base
    def load
      create_record :user, :john, :name =&gt; 'John', :password =&gt; 'doodaht'
      create_record :user, :cindy, :name =&gt; 'Cindy', :password =&gt; 'whoot!'
    end
  end
</pre>
<p>
In the example above, I&#8216;m using the <tt>create_record</tt> instance
method to create two users: John and Cindy. Notice the calls to
<tt>create_record</tt>. There are three parameters. The first is the
singular name of the table to insert the record into, the second is the
symbolic name of the record (more on that later), and the third is a hash
of the attributes of the record.
</p>
<p>
To use the UsersScenario in a description, you should declare it using the
<tt>scenario</tt> method:
</p>
<pre>
  # in spec/models/user_spec.rb
  describe User do
    scenario :users

    it &quot;should allow me to do something with John&quot; do
      user = users(:john)
      user.password.should == &quot;doodaht&quot;
    end
  end
</pre>
<p>
Notice that it is easy to <a href="Scenario.html#M000005">load</a> an
instance of a model object using its symbolic name with a reader method,
similar to that of Rails&#8217; fixtures. In the example above, I loaded
John with the reader method <tt>users</tt> and the symbolic name
<tt>:john</tt>. (Remember that in the Users scenario I declared that John
should be accessible through the symbolic name <tt>:john</tt>.)
</p>
<h3>Composition</h3>
<p>
In real life your scenarios will probably grow quite complicated. The
scenarios plugin allows you to deal with this complexity through
composition.
</p>
<p>
Here&#8216;s a simple example:
</p>
<pre>
  # in spec/scenarios/posts_scenario.rb
  class PostsScenario &lt; Scenario::Base
    def load
      create_record :post, :first, :title =&gt; &quot;First Post&quot;
      create_record :post, :second, :title =&gt; &quot;Second Post&quot;
    end
  end

  # in spec/scnearios/comments_scenario.rb
  class CommentsScenario &lt; Scenario::Base
    uses :posts

    def load
      create_record :comment, :first, :body =&gt; &quot;Nice post!&quot;, :post_id =&gt; post_id(:first)
      create_record :comment, :second, :body =&gt; &quot;I like it.&quot;, :post_id =&gt; post_id(:first)
      create_record :comment, :third, :body =&gt; &quot;I thoroughly disagree.&quot;, :post_id =&gt; post_id(:second)
    end
  end
</pre>
<p>
In the example above, the CommentsScenario declares that it depends on the
Posts scenario with the <tt>uses</tt> class method. This means that if you
<a href="Scenario.html#M000005">load</a> the CommentsScenario, the
PostsScenario will be loaded first and the CommentsScenario will have
access to all the data loaded by the PostsScenario in its own <tt><a
href="Scenario.html#M000005">load</a></tt> method. Note that inside the <a
href="Scenario.html#M000005">load</a> method I&#8216;m using another form
of reader methed which simply gives you the id for a symbolic name (in this
case: <tt>post_id</tt>). This is most useful for making associations, as
done here with comments and posts.
</p>
<h3>Helper Methods</h3>
<p>
Another way of simplifying your scenarios and specs is through helper
methods. The <a href="Scenarios.html">Scenarios</a> plugin provides a handy
way to declare helper methods that are accessible from inside the scenario
and also from inside related RSpec examples:
</p>
<pre>
  # in spec/scenarios/users_scenario.rb
  class UsersScenario &lt; Scenario::Base
    def load
      create_user :name =&gt; &quot;John&quot;
    end

    helpers do
      def create_user(attributes={})
        create_record :user, attributes[:name].downcase.intern, attributes
      end
      def login_as(user)
        @request.session[:user_id] = user.id
      end
    end
  end
</pre>
<p>
Helper methods declared inside the helpers block are mixed into the
scenario when it is instantiated and mixed into examples that declare that
they are using the scenario. Also, in the case where one scenario
<tt>uses</tt> another, the using scenario will have the helper methods of
the used scenario.
</p>
<pre>
  # in spec/controllers/projects_controller_spec.rb
  describe &quot;Projects screen&quot; do
    scenario :users

    it &quot;should show active projects&quot; do
      login_as(users(:john))
      get :projects
      @response.should have_tag('#active_projects')
    end
  end
</pre>
<p>
Notice that in the RSpec example I have access to the login_as helper
method declared inside the <tt>helpers</tt> block of the UsersScenario. <a
href="Scenario.html">Scenario</a> helpers are a great way to share helper
methods between specs that use a specific scenario.
</p>
<h3>Load Rake Task</h3>
<p>
The <a href="Scenarios.html">Scenarios</a> plugin provides a single Rake
task, <tt>db:scenario:<a href="Scenario.html#M000005">load</a></tt>, which
you may use in a fashion similar to Rails fixtures&#8217;
<tt>db:fixtures:<a href="Scenario.html#M000005">load</a></tt>.
</p>
<pre>
  rake db:scenario:load SCENARIO=comments
</pre>
<p>
When invoked, this task will populate the development database with the
named scenario.
</p>
<p>
If you do not specify SCENARIO, the task will expect to find a default
scenario (a file &#8216;default_scenario.rb&#8217; having DefaultScenario
defined in it). It is our practice to have it such that this scenario
<tt>uses</tt> a number of our other scenarios, thereby:
</p>
<ul>
<li>encouraging us to use test data that looks good in the running development
application

</li>
<li>allowing us to troubleshoot failing tests in the running development
application

</li>
</ul>
<h3>More Information</h3>
<p>
For more information, I&#8216;d recommend that you study the source. The
specs and example scenarios are probably good places to start:
</p>
<ul>
<li><a
href="http://faithfulcode.rubyforge.org/svn/plugins/trunk/scenarios/spec/scenarios_spec.rb">faithfulcode.rubyforge.org/svn/plugins/trunk/scenarios/spec/scenarios_spec.rb</a>

</li>
<li><a
href="http://faithfulcode.rubyforge.org/svn/plugins/trunk/scenarios/spec/scenarios">faithfulcode.rubyforge.org/svn/plugins/trunk/scenarios/spec/scenarios</a>

</li>
</ul>
<h3>License</h3>
<p>
The <a href="Scenarios.html">Scenarios</a> plugin is released under the
MIT-License and is Copyright (c) 2007, Adam Williams and John W. Long.
Special thanks to Chris Redinger for his part in helping us get this plugin
ready for the public.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000005">load</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Module <a href="Scenario/TableMethods.html" class="link">Scenario::TableMethods</a><br />
Class <a href="Scenario/Base.html" class="link">Scenario::Base</a><br />
Class <a href="Scenario/InvalidScenario.html" class="link">Scenario::InvalidScenario</a><br />

    </div>




      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="Scenario.src/M000005.html" target="Code" class="method-signature"
            onclick="popupCode('Scenario.src/M000005.html');return false;">
          <span class="method-name">load</span><span class="method-args">(scenario_name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Load a scenario by name. <tt>scenario_name</tt> can be a string, symbol, or
the scenario class.
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>